SELECT distinct
a.NATIONAL_ID_C AS CPF,
m.MERCHANT_CODE,
m.MERCHANT_ID,
m.LEGAL_TYPE_NAME AS legal_type,
ac.MCC_CODE_C AS current_mcc,
ac.NAME AS business_name,
vmd.MCC_NATURE_PURPOSE AS NATURE_PURPOSE,
a.NAME AS full_name,
m2.SIGN_UP_TIME::date AS signup_date,
bd.TAX_ID AS CNPJ,
CASE 
	WHEN gl.MERCHANT_SIGN_UP_AT >= '2024-11-01' THEN 'Pos_SERPRO'
	ELSE 'before_SERPRO'
END AS eKYB_SERPRO,
CASE
	WHEN ac.MCC_CODE_C IN ('0742','1799','4121','5399','5499','5697','5699','5963','5970','7230','7299','7349','7379','7399',
'7538','8011','8021','8099','8111','8999') then 'Match_Abecs'
ELSE 'not_match'
END as ABECS_29
FROM GLOBAL_ANALYST_PROD.MART_MERCHANT.MERCHANTS M
LEFT JOIN GLOBAL_ANALYST_PROD.MART_CORE.PAYMENTS_MERCHANT_METRICS MC ON M.MERCHANT_CODE = MC.MERCHANT_CODE
LEFT JOIN SUMUP_DWH_PROD.OLAP.V_M_DIM_MERCHANT VMD ON VMD.MERCHANT_CODE = M.MERCHANT_CODE
LEFT JOIN SUMUP_DWH_PROD.SRC_SALESFORCE."ACCOUNT" ac ON m.MERCHANT_CODE = ac.MERCHANT_CODE_C
LEFT JOIN SUMUP_DWH_PROD.SRC_SALESFORCE.contact a ON ac.id = a.ACCOUNT_ID
LEFT JOIN SUMUP_DWH_PROD.SRC_RISK_AND_COMPLIANCE.AML_RISK_LEVEL_5_TIER_EXTENDED hr ON m.MERCHANT_CODE = hr.MERCHANT_CODE
LEFT JOIN global_analyst_prod.mart_growth.verification_merchant_verification_status gl ON m.merchant_code = gl.MERCHANT_CODE
LEFT JOIN GLOBAL_ANALYST_PROD.MART_CORE.PAYMENTS_MERCHANT_METRICS ip ON m.MERCHANT_CODE = ip.MERCHANT_CODE
LEFT JOIN SUMUP_DWH_PROD.src_payment.merchants m2 ON GL.MERCHANT_CODE = M2.MERCHANT_CODE 
left join SUMUP_DWH_PROD.SRC_PAYMENT.USERS u on gl.merchant_id = u.MERCHANT_ID
left join SUMUP_DWH_PROD.SRC_PAYMENT.PERSONAL_DETAILS pd ON u.PERSONAL_DETAIL_ID = pd.ID
LEFT JOIN SUMUP_DWH_PROD.SRC_PAYMENT.BUSINESS_DETAILS bd ON gl.merchant_id = bd.MERCHANT_ID
WHERE 1=1
--AND a.NATIONAL_ID_C IN () ---- inserir CPF quando for notificação PF
--AND bd.TAX_ID IN () ---- inserir CNPJ quando for notificação PJ  
--AND m.LEGAL_TYPE_NAME = 'pessoa física'
AND m.MERCHANT_CODE IN ('MCNDNYE2','MFAYZCCE')
